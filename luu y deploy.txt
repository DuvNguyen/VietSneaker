Má»¤C TIÃŠU CUá»I

NgÆ°á»i dÃ¹ng truy cáº­p: http://4.241.131.190

KhÃ´ng hiá»‡n port

KhÃ´ng lá»—i SSL trÃªn trÃ¬nh duyá»‡t

Backend Spring Boot cháº¡y HTTPS tá»± kÃ½ (ná»™i bá»™)

Nginx lÃ m reverse proxy

Docker chá»‰ cháº¡y image, khÃ´ng cáº§n source code

Tá»”NG QUAN KIáº¾N TRÃšC (Ä‘á»ƒ báº¡n kiá»ƒm soÃ¡t Ä‘Æ°á»£c)
Internet
   |
   | HTTP :80
   v
Nginx (host OS)
   |
   | HTTP :3000 (internal)
   v
Next.js container
   |
   | HTTP /api/*
   v
Nginx
   |
   | HTTPS :8083 (self-signed)
   v
Spring Boot container

BÆ¯á»šC 0 â€“ Chuáº©n bá»‹ VM

Giáº£ sá»­:

Ubuntu 20.04 / 22.04

IP: 4.241.131.190

ÄÃ£ SSH Ä‘Æ°á»£c vÃ o mÃ¡y

ssh ubuntu@4.241.131.190

BÆ¯á»šC 1 â€“ CÃ i Docker (Báº®T BUá»˜C)
1.1 Update há»‡ thá»‘ng
sudo apt update && sudo apt upgrade -y

1.2 CÃ i Docker
sudo apt install -y docker.io

1.3 Enable Docker
sudo systemctl start docker
sudo systemctl enable docker

1.4 Cho user cháº¡y docker khÃ´ng cáº§n sudo
sudo usermod -aG docker ubuntu
newgrp docker


Kiá»ƒm tra:

docker --version

BÆ¯á»šC 2 â€“ CÃ i Docker Compose (plugin má»›i)
sudo apt install -y docker-compose-plugin


Kiá»ƒm tra:

docker compose version


âš ï¸ LÆ°u Ã½: dÃ¹ng docker compose (khÃ´ng cÃ³ dáº¥u -)

BÆ¯á»šC 3 â€“ CÃ i Nginx trÃªn HOST (KHÃ”NG trong Docker)
sudo apt install -y nginx
sudo systemctl start nginx
sudo systemctl enable nginx


Kiá»ƒm tra:

curl http://localhost

BÆ¯á»šC 4 â€“ Cáº¥u hÃ¬nh NGINX (QUAN TRá»ŒNG NHáº¤T)
4.1 XÃ³a config máº·c Ä‘á»‹nh
sudo rm /etc/nginx/sites-enabled/default

4.2 Táº¡o config má»›i
sudo nano /etc/nginx/sites-available/vietsneaker

4.3 DÃ¡n Y NGUYÃŠN ná»™i dung sau
server {
    listen 80;
    server_name 4.241.131.190;

    # FRONTEND (Next.js)
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # BACKEND (Spring Boot HTTPS tá»± kÃ½)
    location /api/ {
        proxy_pass https://localhost:8083/api/;
        proxy_ssl_verify off;

        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto http;
    }
}

4.4 Enable site
sudo ln -s /etc/nginx/sites-available/vietsneaker /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx

BÆ¯á»šC 5 â€“ Táº¡o docker-compose.yml (CHá»ˆ DÃ™NG IMAGE)

Táº¡o thÆ° má»¥c lÃ m viá»‡c:

mkdir ~/vietsneaker && cd ~/vietsneaker


Táº¡o file:

nano docker-compose.yml

Ná»™i dung docker-compose.yml (MáºªU CHUáº¨N)

âš ï¸ Báº¡n chá»‰ cáº§n thay tÃªn image cho Ä‘Ãºng vá»›i image báº¡n Ä‘ang cÃ³

version: "3.8"

services:
  vietsneaker-server:
    image: your-dockerhub/vietsneaker-backend:latest
    container_name: vietsneaker-server
    ports:
      - "127.0.0.1:8083:8083"
    restart: always

  vietsneaker-ui:
    image: your-dockerhub/vietsneaker-frontend:latest
    container_name: vietsneaker-ui
    ports:
      - "127.0.0.1:3000:3000"
    environment:
      - BACKEND_URL=http://4.241.131.190
      - NODE_TLS_REJECT_UNAUTHORIZED=0
    restart: always


ğŸ“Œ Giáº£i thÃ­ch quan trá»ng

127.0.0.1:xxxx â†’ chá»‰ Nginx gá»i Ä‘Æ°á»£c

Internet khÃ´ng scan Ä‘Æ°á»£c port

ÄÃºng chuáº©n production

BÆ¯á»šC 6 â€“ Pull image & cháº¡y
docker compose pull
docker compose up -d


Kiá»ƒm tra:

docker ps

BÆ¯á»šC 7 â€“ TEST
7.1 Test ná»™i bá»™
curl http://localhost
curl http://localhost/api/health

7.2 Test tá»« trÃ¬nh duyá»‡t

ğŸ‘‰ Má»Ÿ:

http://4.241.131.190

Káº¾T QUáº¢ CUá»I (CHUáº¨N OPS)

âœ… KhÃ´ng lá»—i SSL
âœ… KhÃ´ng lá»™ port
âœ… KhÃ´ng cáº§n domain
âœ… KhÃ´ng cáº§n cert xá»‹n
âœ… KhÃ´ng cáº§n source code
âœ… ÄÃºng mÃ´ hÃ¬nh Reverse Proxy chuáº©n

Khi nÃ o cáº§n HTTPS tháº­t?

ğŸ‘‰ Chá»‰ cáº§n:

Mua domain

Trá» domain vá» IP

Cháº¡y:

sudo certbot --nginx -d tenmien.com


KhÃ´ng Ä‘á»™ng tá»›i Docker, khÃ´ng rebuild gÃ¬ háº¿t.

Náº¿u báº¡n muá»‘n:

MÃ¬nh review image backend cÃ³ báº­t HTTPS Ä‘Ãºng chÆ°a

Check lá»—i 502 Bad Gateway

Debug SSLHandshakeException

Harden security (rate limit, headers)

ğŸ‘‰ Cá»© paste log ra, mÃ¬nh xá»­ lÃ½ tiáº¿p cho báº¡n




import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  eslint: {
    // Cho phÃ©p build production dÃ¹ cÃ³ lá»—i eslint
    ignoreDuringBuilds: true,
  },

  // DÃ¹ng standalone cho Docker
  output: "standalone",

  // ğŸ”¥ REWRITE API â†’ BACKEND CONTAINER
  async rewrites() {
    const backendUrl = process.env.BACKEND_URL || "https://4.241.131.190";
    return [
      {
        source: "/api/:path*",
        destination: `${backendUrl}/api/:path*`,
      },
    ];
  },
};

export default nextConfig;


// src/config/app-config.ts

// âŒ KHÃ”NG dÃ¹ng HOST ná»¯a
// Browser chá»‰ gá»i relative path

export const CONTEXT_API = "/api";
export const API_BASE = CONTEXT_API;

export const USERNAME_COOKIE_KEY = "user";
export const ROLES_COOKIE_KEY = "roles";
export const UNIT = 1000000;
